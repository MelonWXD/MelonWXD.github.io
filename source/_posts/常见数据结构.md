---
title: 常见数据结构分析 
date: 2018-03-01 11:01:33
tags: [数据结构]  
categories: Android
---
ArrayList、LinkedList、HashMap、LinkedHashMap实现
<!-- more -->  

# HashMap

数组+链表实现

![](https://upload-images.jianshu.io/upload_images/1956855-e0aa3ef55cd31303.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/700)

```java
    transient Node<K,V>[] table;

    /**
     * Holds cached entrySet(). Note that AbstractMap fields are used
     * for keySet() and values().
     */
    transient Set<Map.Entry<K,V>> entrySet;
```



每个Entry为Node实例

```java
    static class Node<K,V> implements Map.Entry<K,V> {
        final int hash;
        final K key;
        V value;
        Node<K,V> next;
    }
```

***

根据key的hash值找到数组的位置i

```java
    static final int hash(Object key) {
        int h;
        return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
    }		

	/**
     * Returns index for hash code h.
     */
    static int indexFor(int h, int length) {
        return h & (length-1);
    }
```

然后遍历以数组[i]为头节点的链表，如果发现有节点的hash，key都相同的节点时，就替换为新的value，然后返回旧的value，没有就加到尾巴去

```java
    public V put(K key, V value) {
        return putVal(hash(key), key, value, false, true);
    }
```



# LinkedHashMap

https://www.jianshu.com/p/83648fa22c4c

entrySet的改变：

```java
    static class LinkedHashMapEntry<K,V> extends HashMap.Node<K,V> {
        LinkedHashMapEntry<K,V> before, after;
        LinkedHashMapEntry(int hash, K key, V value, Node<K,V> next) {
            super(hash, key, value, next);
        }
    }
```

```java
    /**
     * The head (eldest) of the doubly linked list.
     */
    transient LinkedHashMapEntry<K,V> head;

    /**
     * The tail (youngest) of the doubly linked list.
     */
    transient LinkedHashMapEntry<K,V> tail;
```

在Hashmap中有在put方法中预留给LinkedHashmap操作的方法

```java
    // Callbacks to allow LinkedHashMap post-actions
    void afterNodeAccess(Node<K,V> p) { }
    void afterNodeInsertion(boolean evict) { }
    void afterNodeRemoval(Node<K,V> p) { }

```

增加大量规则来维护head tail双向链表